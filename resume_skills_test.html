<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Resume Skills Test</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        margin: 20px;
        line-height: 1.6;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
      }
      .test-section {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        margin: 20px 0;
      }
      .result {
        background: white;
        padding: 15px;
        border-radius: 6px;
        margin: 10px 0;
        border-left: 4px solid #0077b5;
      }
      .success {
        border-left-color: #28a745;
      }
      .warning {
        border-left-color: #ffc107;
      }
      .error {
        border-left-color: #dc3545;
      }
      button {
        background: #0077b5;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        cursor: pointer;
        margin: 5px;
      }
      button:hover {
        background: #005582;
      }
      .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 1000;
      }
      .modal-content {
        background: white;
        padding: 30px;
        border-radius: 12px;
        max-width: 600px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
      }
      .skill-tag {
        background: #0077b5;
        color: white;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        margin: 2px;
        display: inline-block;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ü§ñ LinkedIn Job Assistant - Resume Skills Test</h1>
      <p>
        This page tests the resume skills functionality and integration with the
        backend.
      </p>

      <div class="test-section">
        <h2>Test 1: Job Analysis WITHOUT Resume</h2>
        <p>Tests the case where user hasn't uploaded a resume yet.</p>
        <button onclick="testWithoutResume()">üîç Test Without Resume</button>
        <div id="result1" class="result" style="display: none"></div>
      </div>

      <div class="test-section">
        <h2>Test 2: Job Analysis WITH Resume</h2>
        <p>
          Tests the case where user has uploaded a resume and skills should be
          extracted.
        </p>
        <button onclick="testWithResume()">üìÑ Test With Resume</button>
        <div id="result2" class="result" style="display: none"></div>
      </div>

      <div class="test-section">
        <h2>Test 3: Resume Parsing Only</h2>
        <p>Tests the resume parsing endpoint directly.</p>
        <button onclick="testResumeParsingOnly()">
          ‚öôÔ∏è Test Resume Parsing
        </button>
        <div id="result3" class="result" style="display: none"></div>
      </div>

      <div class="test-section">
        <h2>Test 4: Content Script Logic</h2>
        <p>
          Tests the frontend logic for displaying resume skills in the modal.
        </p>
        <button onclick="testContentScriptLogic()">
          üé≠ Test Frontend Logic
        </button>
        <div id="result4" class="result" style="display: none"></div>
      </div>
    </div>

    <!-- Mock Modal for Testing Content Script Logic -->
    <div id="testModal" class="modal">
      <div class="modal-content">
        <h3>Test Job Analysis Modal</h3>
        <div id="mockModalContent"></div>
        <button onclick="closeModal()">Close</button>
      </div>
    </div>

    <script>
      const API_BASE = "http://localhost:5000/api";

      async function testWithoutResume() {
        const resultDiv = document.getElementById("result1");
        resultDiv.style.display = "block";
        resultDiv.innerHTML =
          "<p>üîÑ Testing job analysis without resume...</p>";

        try {
          const response = await fetch(`${API_BASE}/analyze-job`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              job_data: {
                type: "job_page",
                title: "Python Backend Developer",
                company: "TestCorp",
                description:
                  "Looking for Python developer with Flask experience",
                content: "Build APIs and work with databases",
              },
              user_profile: {
                name: "Test User",
                experience: 1,
                skills: ["Python", "Flask"],
                email: "test@example.com",
                resumeUrl: "", // No resume
              },
            }),
          });

          const result = await response.json();

          let html = "<h4>‚úÖ Test Results</h4>";
          html += `<p><strong>Status:</strong> ${result.status}</p>`;
          html += `<p><strong>Has Resume:</strong> ${result.has_resume}</p>`;
          html += `<p><strong>Resume Skills Used:</strong> ${result.resume_skills_used}</p>`;
          html += `<p><strong>Skills Count:</strong> ${result.resume_skills_count}</p>`;

          if (
            result.has_resume === false &&
            result.resume_skills_used === false
          ) {
            resultDiv.className = "result success";
            html +=
              "<p><strong>‚úÖ PASS:</strong> Correctly identified no resume uploaded.</p>";
          } else {
            resultDiv.className = "result error";
            html +=
              "<p><strong>‚ùå FAIL:</strong> Should show has_resume=false when no resume.</p>";
          }

          resultDiv.innerHTML = html;
        } catch (error) {
          resultDiv.className = "result error";
          resultDiv.innerHTML = `<p><strong>‚ùå ERROR:</strong> ${error.message}</p>`;
        }
      }

      async function testWithResume() {
        const resultDiv = document.getElementById("result2");
        resultDiv.style.display = "block";
        resultDiv.innerHTML = "<p>üîÑ Testing job analysis with resume...</p>";

        try {
          const response = await fetch(`${API_BASE}/analyze-job`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              job_data: {
                type: "job_page",
                title: "Senior Python Backend Developer",
                company: "TestCorp",
                description:
                  "Looking for Python developer with Flask, FastAPI, and machine learning experience",
                content:
                  "Build scalable APIs, work with TensorFlow, use PostgreSQL databases",
              },
              user_profile: {
                name: "Test User",
                experience: 1,
                skills: ["Python", "Flask"],
                email: "test@example.com",
                resumeUrl:
                  "/Users/heetdedakiya/Documents/Github/ai-chrome-extension-tool/backend/uploads/test_resume.txt",
              },
            }),
          });

          const result = await response.json();

          let html = "<h4>üìÑ Test Results</h4>";
          html += `<p><strong>Status:</strong> ${result.status}</p>`;
          html += `<p><strong>Has Resume:</strong> ${result.has_resume}</p>`;
          html += `<p><strong>Resume Skills Used:</strong> ${result.resume_skills_used}</p>`;
          html += `<p><strong>Skills Count:</strong> ${result.resume_skills_count}</p>`;
          html += `<p><strong>Total Skills:</strong> ${result.total_resume_skills}</p>`;

          if (
            result.relevant_resume_skills &&
            result.relevant_resume_skills.length > 0
          ) {
            html += "<p><strong>Relevant Skills:</strong></p>";
            html += "<div>";
            result.relevant_resume_skills.forEach((skill) => {
              html += `<span class="skill-tag">${skill}</span>`;
            });
            html += "</div>";
          }

          html += "<p><strong>Email Body:</strong></p>";
          html += `<div style="background: #f0f0f0; padding: 10px; border-radius: 4px; font-size: 14px; white-space: pre-wrap;">${result.email_body}</div>`;

          if (
            result.has_resume === true &&
            result.resume_skills_used === true &&
            result.resume_skills_count > 0
          ) {
            resultDiv.className = "result success";
            html +=
              "<p><strong>‚úÖ PASS:</strong> Resume skills successfully integrated.</p>";
          } else {
            resultDiv.className = "result error";
            html +=
              "<p><strong>‚ùå FAIL:</strong> Resume skills not properly integrated.</p>";
          }

          resultDiv.innerHTML = html;
        } catch (error) {
          resultDiv.className = "result error";
          resultDiv.innerHTML = `<p><strong>‚ùå ERROR:</strong> ${error.message}</p>`;
        }
      }

      async function testResumeParsingOnly() {
        const resultDiv = document.getElementById("result3");
        resultDiv.style.display = "block";
        resultDiv.innerHTML = "<p>üîÑ Testing resume parsing...</p>";

        try {
          const response = await fetch(`${API_BASE}/parse-resume`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              file_path:
                "/Users/heetdedakiya/Documents/Github/ai-chrome-extension-tool/backend/uploads/test_resume.txt",
            }),
          });

          const result = await response.json();

          let html = "<h4>‚öôÔ∏è Resume Parsing Results</h4>";
          html += `<p><strong>Success:</strong> ${result.success}</p>`;
          html += `<p><strong>Skills Found:</strong> ${
            result.skill_count || 0
          }</p>`;
          html += `<p><strong>File:</strong> ${result.file_name}</p>`;

          if (result.skills && result.skills.length > 0) {
            html += "<p><strong>Extracted Skills:</strong></p>";
            html += "<div>";
            result.skills.slice(0, 20).forEach((skill) => {
              html += `<span class="skill-tag">${skill}</span>`;
            });
            if (result.skills.length > 20) {
              html += `<span class="skill-tag" style="background: #6c757d;">+${
                result.skills.length - 20
              } more</span>`;
            }
            html += "</div>";
          }

          if (result.success && result.skill_count > 0) {
            resultDiv.className = "result success";
            html +=
              "<p><strong>‚úÖ PASS:</strong> Resume parsing successful.</p>";
          } else {
            resultDiv.className = "result error";
            html +=
              "<p><strong>‚ùå FAIL:</strong> Resume parsing failed or no skills found.</p>";
          }

          resultDiv.innerHTML = html;
        } catch (error) {
          resultDiv.className = "result error";
          resultDiv.innerHTML = `<p><strong>‚ùå ERROR:</strong> ${error.message}</p>`;
        }
      }

      function testContentScriptLogic() {
        const resultDiv = document.getElementById("result4");
        resultDiv.style.display = "block";

        // Test data simulating different scenarios
        const testCases = [
          {
            name: "With Resume Skills",
            data: {
              status: "RELEVANT",
              resume_skills_used: true,
              resume_skills_count: 5,
              relevant_resume_skills: [
                "Python",
                "Flask",
                "TensorFlow",
                "AWS",
                "PostgreSQL",
              ],
              has_resume: true,
            },
          },
          {
            name: "No Resume",
            data: {
              status: "RELEVANT",
              resume_skills_used: false,
              resume_skills_count: 0,
              relevant_resume_skills: [],
              has_resume: false,
            },
          },
          {
            name: "Resume but No Matching Skills",
            data: {
              status: "RELEVANT",
              resume_skills_used: false,
              resume_skills_count: 0,
              relevant_resume_skills: [],
              has_resume: true,
            },
          },
        ];

        let html = "<h4>üé≠ Frontend Logic Test Results</h4>";

        testCases.forEach((testCase, index) => {
          const shouldShowResumeSkills =
            testCase.data.resume_skills_used === true &&
            testCase.data.relevant_resume_skills &&
            testCase.data.relevant_resume_skills.length > 0;

          const shouldShowNoResume = testCase.data.has_resume === false;

          html += `<div style="border: 1px solid #ddd; padding: 10px; margin: 10px 0; border-radius: 4px;">`;
          html += `<h5>${testCase.name}</h5>`;
          html += `<p><strong>Data:</strong> resume_skills_used=${testCase.data.resume_skills_used}, has_resume=${testCase.data.has_resume}, skills_count=${testCase.data.resume_skills_count}</p>`;

          if (shouldShowResumeSkills) {
            html +=
              '<div style="background: #d4edda; padding: 8px; border-radius: 4px; margin: 5px 0;">';
            html +=
              "‚úÖ Would show: Resume skills used section with skills list";
            html += "</div>";
          } else if (shouldShowNoResume) {
            html +=
              '<div style="background: #fff3cd; padding: 8px; border-radius: 4px; margin: 5px 0;">';
            html += "üí° Would show: Upload resume suggestion";
            html += "</div>";
          } else {
            html +=
              '<div style="background: #f8d7da; padding: 8px; border-radius: 4px; margin: 5px 0;">';
            html += "üìÑ Would show: Resume available but no matching skills";
            html += "</div>";
          }

          html += "</div>";
        });

        html +=
          '<button onclick="showMockModal()" style="margin-top: 10px;">üëÄ Show Mock Modal</button>';

        resultDiv.className = "result success";
        resultDiv.innerHTML = html;
      }

      function showMockModal() {
        const modal = document.getElementById("testModal");
        const content = document.getElementById("mockModalContent");

        const mockData = {
          status: "RELEVANT",
          contact: "hr@company.com",
          email_subject: "Application for Python Developer",
          email_body:
            "Dear Hiring Manager, I am interested in the Python Developer position...",
          resume_skills_used: true,
          resume_skills_count: 5,
          relevant_resume_skills: [
            "Python",
            "Flask",
            "TensorFlow",
            "AWS",
            "PostgreSQL",
          ],
          has_resume: true,
        };

        content.innerHTML = generateMockModalContent(mockData);
        modal.style.display = "flex";
      }

      function generateMockModalContent(analysisData) {
        return `
                <div class="status-section">
                    <div class="status-badge relevant">RELEVANT</div>
                    <p>Job matches your profile requirements</p>
                </div>
                
                <div class="contact-section">
                    <h4>Contact Information</h4>
                    <p><strong>Email:</strong> ${analysisData.contact}</p>
                </div>
                
                ${
                  analysisData.resume_skills_used === true &&
                  analysisData.relevant_resume_skills &&
                  analysisData.relevant_resume_skills.length > 0
                    ? `
                    <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin: 10px 0; border-left: 4px solid #28a745;">
                        <h4>üìÑ Resume Analysis</h4>
                        <p><strong>Resume Skills Used:</strong> Yes (${
                          analysisData.resume_skills_count
                        } skills)</p>
                        <p><strong>Relevant Skills:</strong> ${analysisData.relevant_resume_skills
                          .slice(0, 5)
                          .join(", ")}</p>
                        <small style="color: #28a745;">‚ú® Email generated using skills from your resume for better job matching</small>
                    </div>
                `
                    : analysisData.has_resume === false
                    ? `
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 10px 0;">
                        <p style="color: #6c757d;"><small>üí° Upload a resume in settings for more personalized applications</small></p>
                    </div>
                `
                    : `
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 10px 0;">
                        <p style="color: #6c757d;"><small>üìÑ Resume available but no matching skills found for this job</small></p>
                    </div>
                `
                }
                
                <div class="email-section">
                    <h4>Generated Email</h4>
                    <p><strong>Subject:</strong> ${
                      analysisData.email_subject
                    }</p>
                    <p><strong>Body:</strong> ${analysisData.email_body}</p>
                </div>
            `;
      }

      function closeModal() {
        document.getElementById("testModal").style.display = "none";
      }
    </script>
  </body>
</html>
